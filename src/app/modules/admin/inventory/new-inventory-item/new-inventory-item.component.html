<ng-template #loading><mat-spinner diameter="50"></mat-spinner></ng-template>

<div class="body"  *ngIf="item ; else loading">

  <mat-card class="strain-card">

    <mat-card-title style="margin:5px;">
      <div><h3>Item: {{item.productName}} </h3></div>
      <div><h3>Label: {{item.label}} </h3></div>
      <div><h3>Type: {{itemTypeDescription}}       </h3></div>
    </mat-card-title>

    <mat-card-subtitle>

      <div class="grid-container" >
        <div class=" sub-container">
          <div class="item-label">Sku</div>
          <div class="item-info"> {{item.sku}} </div>

          <div class="item-label">Type</div>
          <div class="item-info"> {{item.packageType}} </div>

          <div class="item-label">Intake Category </div>
          <div class="item-info"> {{item.productCategoryName}} </div>

          <div class="item-label">Facility Code</div>
          <div class="item-info"> {{item.facilityLicenseNumber}} </div>

          <div>
            <app-product-search-selector
                class         = "fields"
                [productName] = "item.productName"
                [itemType]    = 1
                [searchForm]  = "inputForm"
                (itemSelect)  = "getItem($event)">
                >
              Change Item
            </app-product-search-selector>
          </div>
        </div>

        <div>
          <div class="button-margins">
            <app-edit-buttons-standard
                (outputeupdateItem)     ="updateItem($event)"
                (outputupdateItemExit)  ="updateItemExit($event)"
                (outputupdatedeleteItem)="deleteItem($event)"
                (outputupdateonCancel)  ="onCancel('false')"
              ></app-edit-buttons-standard>
          </div>

          <div class="toggle-items" *ngIf="inputForm"
               [formGroup]="inputForm">
            <div>
              <mat-slide-toggle
                      class="price-values"
                      formGroupName  ="notAvalibleForSale"
                      formControlName="notAvalibleForSale">
                      <mat-label>Not For Sale</mat-label>
              </mat-slide-toggle>
            </div>

            <div>
              <mat-slide-toggle
                      class="price-values"
                      formGroupName  ="requiresAttention"
                      formControlName="requiresAttention">
                      <mat-label>Requires Attention</mat-label>
              </mat-slide-toggle>
            </div>

            <div *ngIf="(locations$ | async) as locations">
              <mat-form-field appearance="outline">
                <mat-label>Locations</mat-label>
                <mat-select
                            type="text"
                            (selectionChange)="setLocation($event)"
                            formControlName="locationID" >
                    <mat-option [value]=0>All</mat-option>
                    <mat-option *ngFor="let item of locations"
                                [value]="item.id">
                      {{ item.name }}
                    </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

    </mat-card-subtitle>

    <mat-card-content >
      <div class="grid-container">

        <div class="subtitle grid-container">
          <div>
            <app-inventory-header-values
              [item]="item">
            </app-inventory-header-values>
          </div>

          <div class="grid-spanner">
          </div>
        </div>

        <div>

          <div class="ps-flex-group-content-start" 
                [formGroup]="inputForm">
            
            <div>
              <app-price-category-select
                    [isInventory]     ="true"
                    [priceCategoryID] ="item.priceCategoryID"
                    [inputForm]       ="inputForm" >
                <div  class="header-column">Price</div>
              </app-price-category-select>

              <div>
                <mat-hint>Changing the sku will require re-labeling.</mat-hint>
                <app-value-fields
                    [fieldType]="'text'"
                    [inputForm]="inputForm"
                    [fieldName]="'sku'"
                  >Change Sku
                </app-value-fields>
              </div>
            </div>
            
            <div *ngIf="isCannabis" >

              <mat-tab-group>
                <mat-tab label="Values">
                  <app-facility-search-selector
                      [item]="facility"
                      [searchForm]="inputForm"
                      (itemSelect)="getVendor($event)">
                  </app-facility-search-selector>

                  <mat-form-field appearance="outline" >
                    <mat-label>Test Date</mat-label>
                    <input  matInput
                            type="text"
                            formControlName="testDate"
                            name="testDate"
                            [matDatepicker]="picker">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
              
                  <mat-form-field appearance="outline" >
                    <mat-label>Expiration</mat-label>
                    <input  matInput
                            type="text"
                            formControlName="expiration"
                            name="expiration"
                            [matDatepicker]="picker">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>

                  <app-value-fields
                        [inputForm]="inputForm"
                        [fieldName]="'testedBy'">
                    Tested By
                  </app-value-fields>

                  <app-value-fields
                      [inputForm]="inputForm"
                      [fieldName]="'testLotNumber'">
                    Test Lot #
                  </app-value-fields>

                </mat-tab>

                <mat-tab label="Chemicals">
                  <app-chemical-values
                    [inputForm]="inputForm"
                    [inventoryItem]="true">
                  </app-chemical-values> 
                </mat-tab>
              </mat-tab-group>

            </div>

            <div *ngIf="!isCannabis"                      
                      class="grid-container">

                <mat-hint>
                  Case Information - only for whole case / split case options
                </mat-hint>

                <div>
                  <app-value-fields
                    [inputForm]="inputForm"
                    [fieldName]="'caseQuantity'">
                    Case Quantity
                  </app-value-fields>
                </div>

                <div >
                  <app-value-fields
                    [inputForm]="inputForm"
                    [fieldName]="'casePrice'">
                    Case Price
                  </app-value-fields>
                </div>

                <div>
                  <app-value-fields
                    [inputForm]="inputForm"
                    [fieldName]="'itemSku'">
                    Item Sku
                  </app-value-fields>
                </div>

                <div>
                  <mat-form-field appearance="outline" >
                    <mat-label>Expiration</mat-label>
                    <input  matInput
                            type="text"
                            formControlName="expiration"
                            name="expiration"
                            [matDatepicker]="picker">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
                </div>

            </div>

          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

