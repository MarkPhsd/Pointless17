<mat-toolbar [class]="mattoolbar"
             [color]="matToolbarColor">
  <mat-toolbar-row>

    <div [class]="flexsections">
      <div [class]="gridlayout">

        <div *ngIf="!smallDevice && isApp">
          <button aria-label="back" mat-button
                  (click)="goBack()">
            <mat-icon aria-hidden="true">keyboard_arrow_left</mat-icon>
          </button>
        </div>

        <div class="logo" *ngIf="!isApp" >
          <app-logo [logoSize]="'small'" ></app-logo>
        </div>

        <div *ngIf="isUserStaff || isAdmin">
          <button aria-label="menu"
                  mat-button
                  (click)="toggleSideBar()">
            <mat-icon>{{menuBar}}</mat-icon>
          </button>
        </div>

        <div>
          <button aria-label="search"
                  mat-button
                  (click)="toggleSearchMenu()">
            <mat-icon>{{searchBar}}</mat-icon>
          </button>
        </div>

        <div>
          <button aria-label="home"
                  mat-button
                  (click)="goHome()">
            <mat-icon >home</mat-icon>
          </button>
        </div>

        <div *ngIf="!smallDevice" >
          <div class="site-name" *ngIf="site && site.name && site.name != undefined">
            <div *ngIf="site?.name.toLowerCase() != 'local'">
              <h2 > {{ site?.name.toUpperCase() | truncateText : 8 }} </h2>
            </div>
          </div>
        </div>

        <div  *ngIf="!smallDevice" >
          <button aria-label="location_on"
                  mat-button
                  (click)="siteSelector()">
            <mat-icon>location_on</mat-icon>
          </button>
        </div>

        <div>
          <api-status-display></api-status-display>
        </div>

      </div>

      <div class="grid-flow"
           *ngIf="!phoneDevice">

        <mat-card class='panel-card'
                  *ngIf="( (isUserStaff && platFormService.platForm !='web' )
                        || (isUserStaff) )">
          <ul
            class="ul-pos-panel"
            fxFlex fxLayout="row"
            fxLayoutAlign="top center">

            <li *ngIf="employeeName && !smallDevice">
              <div class="pos-name">
                <h2>  {{employeeName.toUpperCase() | truncateText : 8}} </h2>
              </div>
            </li>

            <li *ngIf="!smallDevice">
              <div class="pos-name"
                    *ngIf="(orderService && orderService.posName && showSearchForm) "
                    id="pos-name">
                <h2 > | {{ orderService?.posName.substr(0, 5) }} | </h2>
              </div>
            </li>

            <li *ngIf="!smallDevice">
              <div class='search-input'>
                <button mat-button
                        color="accent"
                        aria-label="POS"
                        (click)="navPOSOrders()">
                  <mat-icon>point_of_sale</mat-icon>
                </button>
              </div>
            </li>

            <ng-container [ngTemplateOutlet]="isfloorPlan"></ng-container>

            <li *ngIf="platFormService.androidApp">
              <div class='search-input'>
                  <button mat-button
                          aria-label="badge"
                          routerLinkActive="list-item-active"
                          routerLink="/barcodescanner">
                    <mat-icon>badge</mat-icon>
                  </button>
              </div>
            </li>

            <li *ngIf="!phoneDevice">
              <list-product-search-input></list-product-search-input>
            </li>

            <li *ngIf="scaleInfo && (platFormService && platFormService.isAppElectron)">
              <div class='search-input'>
                {{scaleInfo?.value}} {{scaleInfo?.mode}}
              </div>
            </li>

            <li *ngIf="platFormService.isApp()">
              <div class='search-input'>
                <button mat-button
                        aria-label="transfer_within_a_station"
                        color="accent"
                        (click)="switchUser()">
                  <mat-icon>transfer_within_a_station</mat-icon>
                </button>
              </div>
            </li>
          </ul>
        </mat-card>

      </div>

      <div *ngIf="!smallDevice && !isUserStaff" [class]="gridlayout">
        <div>
          <app-company-info-header [isUser]="!isUserStaff"></app-company-info-header>
        </div>
      </div>

      <div [class]="gridlayout">

        <div *ngIf="!smallDevice && isAdmin">

          <clock-in-out [displayOnly]="true"></clock-in-out>
          <wizard-progress-button></wizard-progress-button>
        </div>

        <div *ngIf="!smallDevice"
              class="cart-button" >
          <app-cart-button> </app-cart-button>
        </div>

        <div *ngIf="smallDevice">
          <ng-container [ngTemplateOutlet]="userActionsSmallDevice"></ng-container>
        </div>

        <div>
          <ng-container [ngTemplateOutlet]="userInfoScreen"></ng-container>
        </div>

      </div>
    </div>

  </mat-toolbar-row>
</mat-toolbar>

<ng-template #floorPlanTemplate>
  <li>
    <span *ngIf="floorPlans$ | async as floorPlan"  class='search-input'>
      <div *ngIf="floorPlan.length>0">
        <button mat-button
                color="accent"
                (click)="navTableService()"
                aria-label="dining">
          <mat-icon>restaurant</mat-icon>
        </button>
      </div>
    </span>
  </li>
</ng-template>

<ng-template #userActions>
  <div *ngIf="!user">
    <button color="warn"
            mat-button
            aria-label="logout"
            class="nav-item nav-link"
            (click)="logout()">
          Sign In
      <mat-icon>exit_to_app</mat-icon>
    </button>
  </div>

  <div *ngIf="user">

    <button aria-label="user menu"
            mat-raised-button
            [matMenuTriggerFor]="menu"
            #menuTrigger="matMenuTrigger"
            (click)="menuTrigger.openMenu()"
            >
      <mat-icon *ngIf="mailCount == 0 ">person</mat-icon>

      <mat-icon
          *ngIf="mailCount != 0"
          matBadge="{{ mailCount }}"
          matBadgeColor="accent"
          matBadgePosition="before">
          mail
        </mat-icon>
    </button>

    <mat-menu class="mat-menu-panel"
              [overlapTrigger]="false"
              #menu="matMenu">

      <div  class="mat-item">
        <app-request-messages
          [user]="user"
          [hideshowMessages]="true"
          (emitCount)="emailMailCount($event)">
        </app-request-messages>
      </div>

      <span (mouseleave)="menuTrigger.closeMenu()">
        <div  class="mat-item">
          <button
                  mat-button
                  color="accent"
                  class="menu-button"
                  aria-label="logout"
                  (click)="logout()">
                Log Out
              <mat-icon>exit_to_app</mat-icon>
          </button>
          <mat-divider class="mat-divider"></mat-divider>
        </div>

        <div *ngIf="smallDevice">
          <app-cart-button
            [smallDevice]="smallDevice">
          </app-cart-button>
        </div>

        <div  class="mat-item">
          <button
              mat-button
              color="accent"
              class="menu-button"
              aria-label="face"
              routerLink="/app-profile">
              {{ user?.lastName }} - {{userRoles}}
              <mat-icon>face</mat-icon>
          </button>
          <mat-divider class="mat-divider"></mat-divider>
        </div>

        <div>
          <app-toggle-theme></app-toggle-theme>
        </div>

        <div  mat-menu-item
              *ngIf="smallDevice && siteName"
              class="mat-item" >
            <h2> {{ siteName  }} </h2>
            <mat-divider class="mat-divider"></mat-divider>
        </div>

        <div  class="mat-item"
              *ngIf="smallDevice">
          <button
                  mat-raised-button
                  color="primary"
                  aria-label="location"
                  class="menu-button"
                  (click)="siteSelector()">
            <mat-icon>location_on</mat-icon>
          </button>
          <mat-divider class="mat-divider"></mat-divider>
        </div>

        <div  class="mat-item"
              *ngIf="user && user.roles === 'user'  && user?.username != 'user'">
            <button
                    mat-raised-button
                    color="primary"
                    aria-label="Order history"
                    class="mat-item"
                    (click)="navPOSOrders()">
              My Orders<mat-icon>list</mat-icon>
            </button>
        </div>

        <div>
          <ng-container [ngTemplateOutlet]="isClockInOutOn"></ng-container>
        </div>

        <span  *ngIf="posDevice$ | async as device">
          <!-- {{device | json}} -->
          <mat-divider></mat-divider>
          <li *ngIf="device  && (isAdmin || isManager) && !smallDevice">
            <br>
            <div class='search-input'>
              <button  mat-raised-button (click)="deviceInfo()">
                Device Info  <mat-icon>device_hub</mat-icon>
              </button>
          </div>
        </span>

      </span>

    </mat-menu>
  </div>
</ng-template>

<span *ngIf="(uiTransactionSetting$ | async) as item"></span>
<span *ngIf="(uiHomePageSetting$ | async) as item"></span>

<ng-template #clockInOut>
  <clock-in-out></clock-in-out>
</ng-template>
