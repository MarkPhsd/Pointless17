<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>pointless documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">pointless documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  TaxRate</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/modules/admin/products/item-type/use-group-tax-assignment/use-group-tax-assignment.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                                <li>
                                        <a href="#rate" 
>
                                            rate
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="../miscellaneous/variables.html#s" target="_self" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../miscellaneous/variables.html#s" target="_self" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="rate"></a>
                                        <span class="name "><b>rate</b>
                                            <a href="#rate">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>rate:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, EventEmitter, Input, Output } from &#x27;@angular/core&#x27;;
import { FormBuilder, FormGroup } from &#x27;@angular/forms&#x27;;
import { moveItemInArray, CdkDragDrop, transferArrayItem } from &#x27;@angular/cdk/drag-drop&#x27;;
import { IListBoxItem, IItemsMovedEvent } from &#x27;src/app/_interfaces/dual-lists&#x27;;
import { Observable, Subject ,fromEvent } from &#x27;rxjs&#x27;;
import { of } from &#x27;rxjs&#x27;;
import { IItemBasic, IItemBasicB, IProductSearchResults, MenuService } from &#x27;src/app/_services/menu/menu.service&#x27;;
import { SitesService } from &#x27;src/app/_services/reporting/sites.service&#x27;;
import { IItemType, ItemTypeService, itemType_Categories, ItemType_Categories_Reference } from &#x27;src/app/_services/menu/item-type.service&#x27;;
import { IProductCategory } from &#x27;src/app/_interfaces&#x27;;
import { AutoWidthCalculator } from &#x27;ag-grid-community&#x27;;
import { UseGroupsService, Taxes, UseGroupTax, UseGroups } from &#x27;src/app/_services/menu/use-groups.service&#x27;;
import { UseGroupTaxesService } from &#x27;src/app/_services/menu/use-group-taxes.service&#x27;;
import { TaxesService, UseGroupTaxAssigned, UseGroupTaxAssignedList } from &#x27;src/app/_services/menu/taxes.service&#x27;;

export interface TaxRate {
  id:   number;
  rate: number;
  name: string;
}



@Component({
  selector: &#x27;app-use-group-tax-assignment&#x27;,
  templateUrl: &#x27;./use-group-tax-assignment.component.html&#x27;,
  styleUrls: [&#x27;./use-group-tax-assignment.component.scss&#x27;]
})
export class UseGroupTaxAssignmentComponent implements OnInit {
  // field to use for value of option
  @Input() valueField &#x3D; &#x27;id&#x27;;
  // field to use for displaying option text
  @Input() textField &#x3D; &#x27;name&#x27;;
  // text displayed over the available items list box
  @Input() availableText &#x3D; &#x27;Available items&#x27;;
  // text displayed over the selected items list box
  @Input() selectedText &#x3D; &#x27;Selected items&#x27;;
  // set placeholder text in available items list box
  @Input() availableFilterPlaceholder &#x3D; &#x27;Filter...&#x27;;
  // set placeholder text in selected items list box
  @Input() selectedFilterPlaceholder &#x3D; &#x27;Filter...&#x27;;
  // event called when items are moved between boxes, returns state of both boxes and item moved
  @Output() itemsMoved: EventEmitter&lt;IItemsMovedEvent&gt; &#x3D; new EventEmitter&lt;IItemsMovedEvent&gt;();

  // array of items to display in left box
  @Input() set availables(items: Array&lt;{}&gt;) {
    this.availableItems &#x3D; [...(items || []).map((item: {}, index: number) &#x3D;&gt; ({
      value: item[this.valueField].toString(),
      text: item[this.textField],
    }))];
  }
  // array of items to display in right box
  @Input() set selects(items: Array&lt;{}&gt;) {
    this.selectedItems &#x3D; [...(items || []).map((item: {}, index: number) &#x3D;&gt; ({
      value: item[this.valueField].toString(),
      text: item[this.textField],
    }))];
  }

  //useGroups lists on the left.
  //
  taxes$           : Observable&lt;TaxRate[]&gt;;
  useGroups        : IProductCategory[];
  useGroupID       : number;
  taxID            : number;
  taxRate          : TaxRate;
  assignedStatic   : any;
  allAssigned      : any;

  availableItems: Array&lt;IListBoxItem&gt; &#x3D; [];
  selectedItems : Array&lt;IListBoxItem&gt; &#x3D; [];
  listBoxForm   : FormGroup;

  constructor(
    private useGroupService   : UseGroupsService,
    private useGroupTaxService: UseGroupTaxesService,
    private taxService        : TaxesService,
    private siteService: SitesService,
    public fb: FormBuilder) {
    this.listBoxForm &#x3D; this.fb.group({
      availableSearchInput: [&#x27;&#x27;],
      selectedSearchInput: [&#x27;&#x27;],
    });
  }

  async ngOnInit() {
    const site &#x3D; this.siteService.getAssignedSite()
    this.taxes$ &#x3D; this.taxService.getTaxRates(site);
  }

  // only call this when the tax is selected.
  // pass the taxID, this will show the
  //Group Types that have been assigned on the right, and the taxes that
  //can be assigned on the left.
  //the groups that are assigned will be used to remove from the groups that are avalible.
  async refreshTaxAssignment(taxID: number) {

    const site   &#x3D; this.siteService.getAssignedSite()
    const taxes$ &#x3D; this.taxService.getTaxRateWithGroups(site, taxID)
    const taxes  &#x3D; await taxes$.pipe().toPromise();

    if (taxes) {
      //then we have each group assisnged from the taxes.
      this.assignSelectedAndAvalible(taxes.useGroupTaxes)

    }
  }

  assignSelectedAndAvalible(selectedGroups: UseGroupTaxAssigned[]) {

    const allGroups &#x3D; this.useGroupService.getDefaultGroups();
    console.log(&#x27;assignSelectedAndAvalible&#x27;, selectedGroups)

    if (selectedGroups.length &gt; 0) {
      const groups &#x3D; selectedGroups
      //for each of these, we can remove matching item from the avalble list.
      //avalible

      //Also we assign the in useGroupTaxes to the assigned list.
      //selected
      this.selectedItems &#x3D; []
      groups.forEach(data &#x3D;&gt; {
        this.selectedItems.push({value: data.useGroup.id.toString(), text: data.useGroup.name})
      })
      this.removeSelectedFromAvailable(allGroups, groups)
      return
    }

    if (selectedGroups.length &#x3D;&#x3D; 0) { }

    this.removeSelectedFromAvailable(allGroups, undefined)

  }

  removeSelectedFromAvailable( xallGroups: UseGroups[], xallAssignedGroups: UseGroupTaxAssigned[]): IListBoxItem[]   {
    let allGroups           &#x3D; xallGroups.map( item &#x3D;&gt;          ({ value: item.id.toString(), text: item.name }));

    if (xallAssignedGroups !&#x3D; undefined) {
      let allAssignedGroups   &#x3D; xallAssignedGroups.map( item &#x3D;&gt;  ({ value: item.useGroupID.toString(), text: item.useGroup.name }));
      allAssignedGroups.forEach(item &#x3D;&gt; {
        const value &#x3D; allGroups.find( x &#x3D;&gt; x.text.toLowerCase() &#x3D;&#x3D;&#x3D; item.text.toLowerCase() )
        if (value) {
          allGroups &#x3D; allGroups.filter(item &#x3D;&gt; item !&#x3D;&#x3D; value)
        }
      })
      if (allAssignedGroups !&#x3D; undefined) {
        allGroups &#x3D;  allGroups.filter(item &#x3D;&gt; !allAssignedGroups.includes(item));
      }
    }

    this.refreshUnselected(allGroups)
    return allGroups;
  }

  refreshUnselected(allGroups) {
     this.availableItems  &#x3D; allGroups //.map( item &#x3D;&gt;          ({ value: item.value.toString(), text: item.name }));
  }

  //we are saving the Whole List of assigned or
  //we are saving the added.
  // i feel like it&#x27;s easier to push the whole list,
  //and keep a reference to the selecteditems, then push the whole list.
  saveAssignedGroups() {
    const site &#x3D; this.siteService.getAssignedSite()
    const taxID &#x3D; this.taxID;
    if (taxID) {
      let useGroups &#x3D; {} as UseGroupTaxAssignedList[]
      const selected &#x3D; this.selectedItems
      if (selected) {
        // selected.forEach( item &#x3D;&gt; { useGroups.push( { id:0, taxID: taxID, useGroupID: parseInt(item.value)  }) })
        useGroups &#x3D; selected.map(item &#x3D;&gt; ({ id: 0, useGroupID: parseInt(item.value), taxID: taxID,  }));
        //push the list even if it&#x27;s undefined. This way the list will be deleted if no items are assigned to it.
        const groups$ &#x3D; this.useGroupTaxService.saveList(site, taxID, useGroups)
        groups$.subscribe( data &#x3D;&gt; {
          console.log(&#x27;saved&#x27;)
        })
      }
    }
  }

  convertToIlistBoxItem(listSource: any[]): IListBoxItem[] {
    var result &#x3D; listSource.map(item &#x3D;&gt; ({ value: item.id.toString(), text: item.name }));
    return result
  }

  setItemType(event) {
    this.taxRate &#x3D; event;
    this.taxID &#x3D; this.taxRate.id;
    this.selectedItems &#x3D;[]
    this.refreshTaxAssignment(this.taxRate.id)
  }

  drop(event: CdkDragDrop&lt;IListBoxItem[]&gt;) {
    if (event.previousContainer &#x3D;&#x3D;&#x3D; event.container) {
      moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);
    } else {
      transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);
    }
    // clear marked available items and emit event

      //assign the selected items to the current itemType selected.
    // this.assignArrayToItemType(this.selectedItems)
    this.saveAssignedGroups()

    this.itemsMoved.emit({
      available: this.availableItems,
      selected: this.selectedItems,
      movedItems: event.container.data.filter((v, i) &#x3D;&gt; i &#x3D;&#x3D;&#x3D; event.currentIndex),
      from: &#x27;available&#x27;,
      to  : &#x27;selected&#x27;,
    });
  }

  searchItemsReset() {
    // this.pageSize &#x3D; 1
    // const site &#x3D; this.siteService.getAssignedSite()
    // const productSearchModel &#x3D; this.initProductSearchModel(this.search);
    // this.menuItems$ &#x3D; this.menuService.getProductsBySearchForLists(site, productSearchModel)
  }


}


</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'TaxRate-2.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
