<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>pointless documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">pointless documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  NamesCities</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/modules/admin/settings/database/csv-import/csv-import.component.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#cities" 
>
                                            cities
                                        </a>
                                </li>
                                <li>
                                        <a href="#names" 
>
                                            names
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="cities"></a>
                                        <span class="name "><b>cities</b>
                                            <a href="#cities">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>cities:         <code><a href="../miscellaneous/variables.html#s" target="_self" >string[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../miscellaneous/variables.html#s" target="_self" >string[]</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="names"></a>
                                        <span class="name "><b>names</b>
                                            <a href="#names">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>names:         <code><a href="../miscellaneous/variables.html#s" target="_self" >string[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../miscellaneous/variables.html#s" target="_self" >string[]</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnDestroy, OnInit, ViewChild,Input } from &#x27;@angular/core&#x27;;
import { UntypedFormBuilder, UntypedFormGroup } from &#x27;@angular/forms&#x27;;
import { NgxCsvParser, NgxCSVParserError } from &#x27;ngx-csv-parser&#x27;;
import { combineLatest, Observable,  switchMap } from &#x27;rxjs&#x27;;
import { FakeProductsService, POOrderImport } from &#x27;src/app/_services/data/fake-products.service&#x27;;
import { FakeContactsService } from &#x27;src/app/_services/data/fake-contacts.service&#x27;;
import { FakeInventoryService } from &#x27;src/app/_services/data/fake-inventory.service&#x27;;
import { ExportDataService } from &#x27;src/app/_services/data/export-data.service&#x27;;
import { ImportProductResults, MenuService, OrdersService } from &#x27;src/app/_services&#x27;;
import { FlowPrice, FlowProducts, FlowStrain, ImportFlowPriceResults, ImportFlowProductResults, ImportFlowStainsResults } from &#x27;src/app/_interfaces/import_interfaces/productflow&#x27;;
import { SitesService } from &#x27;src/app/_services/reporting/sites.service&#x27;;
import { FlowVendor, ImportFlowVendorResults, IPOSOrder, IProduct } from &#x27;src/app/_interfaces&#x27;;
import { ClientTableService } from &#x27;src/app/_services/people/client-table.service&#x27;;
import { FlowInventory, ImportFlowInventoryResults } from &#x27;src/app/_interfaces/import_interfaces/inventory-flow&#x27;;
import { OrderMethodsService } from &#x27;src/app/_services/transactions/order-methods.service&#x27;;
export interface NamesCities {
  names: string[];
  cities: string[];
}
@Component({
  selector: &#x27;app-csv-import&#x27;,
  templateUrl: &#x27;./csv-import.component.html&#x27;,
  styleUrls: [&#x27;./csv-import.component.scss&#x27;]
})
export class CSVImportComponent implements OnInit, OnDestroy {
  @Input() purchaseOrderImport : boolean;
  @Input() order: IPOSOrder;
  public timerInterval:any;
  inputForm   : UntypedFormGroup;
  headerValues&#x3D; true;
  csvRecords  : any;
  header      &#x3D; false;
  schemaValue : any;
  itemCount   : number;
  schemaName  : string;
  reportProgress &#x3D; false;
  progress: any;
  progressValue: number;
  progress$                 : Observable&lt;any&gt;;
  importFlowInventoryResults: ImportFlowInventoryResults;
  importProductResults      : ImportProductResults;
  importFlowPriceResults    : ImportFlowPriceResults;
  importFlowVendorResults   : ImportFlowVendorResults;
  flowProductImportresults  : ImportFlowProductResults;
  importFlowStainsResults   : ImportFlowStainsResults;
  productImports            : ImportProductResults;
  resultsMessage            : any;
  random$                   : Observable&lt;any&gt;;
  importing:  boolean;

  constructor(
    private fakeProductsService : FakeProductsService,
    private fakeContactService  : FakeContactsService,
    private fakeInventoryService: FakeInventoryService,
    public exportDataService    : ExportDataService,
    private fb                  : UntypedFormBuilder,
    private siteService:          SitesService,
    private clientTableService: ClientTableService,
    private menuService         : MenuService,
    private orderService        : OrdersService,
    public orderMethodsService  : OrderMethodsService,
    private ngxCsvParser        : NgxCsvParser) { }

  @ViewChild(&#x27;fileDropRef&#x27;) fileImportInput: any;

  ngOnInit(): void {
    const i &#x3D; 0;
    this.initForm()

    if (this.purchaseOrderImport) {
      this.getProgressCount(false)
      return;
    }

    this.getProgress()
    this.getProgressCount(true)
  }

  initForm(){
     this.inputForm &#x3D; this.fb.group({
      id: [],
      name: [],
    })
  }

  ngOnDestroy(): void {
    //Called once, before the instance is destroyed.
    //Add &#x27;implements OnDestroy&#x27; to the class.
    // console.log(&#x27;on destroy&#x27;)
    clearInterval(this.timerInterval)
  }

  fileChangeListener($event: any): void {



    // this.resetFileInfo();
    const files &#x3D; $event.srcElement.files;
    clearInterval(this.timerInterval)
    this.ngxCsvParser.parse(files[0], { header: this.headerValues, delimiter: &#x27;,&#x27; })
      .pipe().subscribe({
        next: (result): void &#x3D;&gt; {
          this.csvRecords &#x3D; result;
          this.itemCount &#x3D; this.csvRecords.length
          this.resultsMessage &#x3D; null;
          if (this.purchaseOrderImport) {
            // console.log(&#x27;will it import?&#x27;)
            this.importPurchaseOrder();
            // this.getSchemaType();
            return;
          }
          this.resetProgressIndicator();
          this.getSchemaType();
        },
        error: (error: NgxCSVParserError): void &#x3D;&gt; {
          this.csvRecords    &#x3D; null;
          this.itemCount     &#x3D; 0;
          this.resultsMessage  &#x3D; error;
        }
      });
  }

  selectScheme(event) {
    this.schemaValue &#x3D; event;
    this.getSchemaType();
    return;
  }

  onFileDropped($event) {
    this.fileChangeListener($event);
  }

  downloadExample() {
    let items &#x3D; [] as any;
    let name &#x3D; &#x27;filename&#x27;;

    if (this.schemaValue &#x3D;&#x3D; 1) {
      items &#x3D; this.fakeProductsService.getRecords(10);
      name &#x3D; &#x27;productsSchema&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 2) {
        items &#x3D; this.fakeContactService.getRecords(10);
        name &#x3D; &#x27;contactSchema&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 3) {
      items &#x3D; this.fakeInventoryService.getRecords(10);
      name &#x3D; &#x27;inventorySchema&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 4) {
      items &#x3D; this.fakeInventoryService.getRecords(10);
      name &#x3D; &#x27;Import Flow Products&#x27;
    }
    this.getSchemaType()

    this.schemaName &#x3D; name;
    if (!items) { return }
    this.downloadFile(items, name)

  }

  getSchemaType(): any {
    let items &#x3D; [] as any;
    let name &#x3D; &#x27;filename&#x27;

    if (this.purchaseOrderImport) {
      items &#x3D; this.fakeProductsService.getOrderRecords(10);
      name &#x3D; &#x27;Import Purchase Order&#x27;
      return ;
    }

    if (this.schemaValue &#x3D;&#x3D; 1) {
      items &#x3D; this.fakeProductsService.getRecords(10);
      name &#x3D; &#x27;Import Products&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 2) {
      items &#x3D; this.fakeInventoryService.getRecords(10);
      name &#x3D; &#x27;Import Inventory&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 3) {
      items &#x3D; this.fakeContactService.getRecords(10);
      name &#x3D; &#x27;Import Contacts&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 4) {
      items &#x3D; this.fakeInventoryService.getRecords(10);
      name &#x3D; &#x27;Import FH Products&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 5) {
      name &#x3D; &#x27;Import FH Prices&#x27;
    }
    if (this.schemaValue &#x3D;&#x3D; 6) {
      name &#x3D; &#x27;Import FH Inventory&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 7) {
      name &#x3D; &#x27;Import FH Clients&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 8) {
      name &#x3D; &#x27;Import FH Vendors&#x27;
    }

    if (this.schemaValue &#x3D;&#x3D; 9) {
      name &#x3D; &#x27;Import FH Strains&#x27;
    }

    this.schemaName &#x3D; name;
    return name
  }

  downloadFile(data: any, name: string) {
      // const replacer &#x3D; (key, value) &#x3D;&gt; value &#x3D;&#x3D;&#x3D; null ? &#x27;&#x27; : value; // specify how you want to handle null values here
      // const header &#x3D; Object.keys(data[0]);
      // let csv &#x3D; data.map(row &#x3D;&gt; header.map(fieldName &#x3D;&gt; JSON.stringify(row[fieldName], replacer)).join(&#x27;,&#x27;));
      // csv.unshift(header.join(&#x27;,&#x27;));
      // let csvArray &#x3D; csv.join(&#x27;\r\n&#x27;);
      // var blob &#x3D; new Blob([csvArray], {type: &#x27;text/csv&#x27; })
      // saveAs(blob, &#x60;${name}.csv&#x60;);
      this.exportDataService.downloadFile(data,name)
  }

  reset() {
    this.schemaValue &#x3D; 0;
    this.schemaName  &#x3D; &#x27;&#x27;;
    this.resetFileInfo();
    this.resetProgressIndicator();
    this.initForm()
  }

  resetFileInfo() {
    this.flowProductImportresults &#x3D; null;
    this.csvRecords &#x3D; null;
    this.resultsMessage &#x3D; &#x27;&#x27;;
    this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
  }

  importFiles() {

    console.log(&#x27;import files&#x27;)
    if (this.purchaseOrderImport) {
      this.getProgressCount(false)
      this.importPurchaseOrder();
      return;
    }

    if (this.schemaValue &#x3D;&#x3D; 1) {
      this.importProducts()
    }
    if (this.schemaValue &#x3D;&#x3D; 2) { }

    if (this.schemaValue &#x3D;&#x3D; 3) { }

    if (this.schemaValue &#x3D;&#x3D; 4) {
      this.importFlowProducts()
    }
    if (this.schemaValue &#x3D;&#x3D; 5) {
      this.importFlowPrices()
    }
    if (this.schemaValue &#x3D;&#x3D; 6) {
      this.importFlowInventory()
    }
    if (this.schemaValue &#x3D;&#x3D; 7) {
      // this.importFlowProduct()
    }
    if (this.schemaValue &#x3D;&#x3D; 8) {
      this.importFlowVendors()
    }
    if (this.schemaValue &#x3D;&#x3D; 9) {
      this.importFlowStrains()
    }
  }

  getProgressCount(report: boolean){
    if (report) {
      this.timerInterval &#x3D; setInterval(() &#x3D;&gt; {
         this.getProgress()
      }, 5000);
      return
    }
    clearInterval(this.timerInterval)
    this.progress$ &#x3D; null;
  }

  getProgress() {
    const site  &#x3D; this.siteService.getAssignedSite()
    if (!this.importing) { return }
    this.menuService.getImportCountProgress(site).subscribe(data &#x3D;&gt; {
      try {
        this.progress &#x3D; data;
        this.progressValue &#x3D;  +((+data.progress/+data.total ) * 100).toFixed(0)
      } catch (error) {
        this.progressValue &#x3D;0
      }
    })
  }

  importFlowProducts(){
    const items &#x3D;  this.csvRecords  as FlowProducts[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.getProgressCount(true)
      this.menuService.importFlowProducts(site,items).subscribe(data &#x3D;&gt; {
        this.flowProductImportresults &#x3D; data;
        this.importing &#x3D; false;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  importFlowStrains(){
    const items &#x3D;  this.csvRecords  as FlowStrain[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.getProgressCount(true)
      this.menuService.importFlowStrains(site,items).subscribe(data &#x3D;&gt; {
        this.importing &#x3D; true;
        this.importFlowStainsResults &#x3D; data;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  importPurchaseOrder() {

    if (!this.order) {return }
    console.log(&#x27;importPurchaseOrder order&#x27;, this.order)

    const items &#x3D;  this.csvRecords  as POOrderImport[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    console.log(&#x27;items&#x27;, items)
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.orderService.importPurchaseOrderCSV(site, this.order, items).subscribe(data &#x3D;&gt; {
        this.orderMethodsService.updateOrder(data)
        this.orderMethodsService.updateOrderSubscription(data)
        this.importing &#x3D; false;
        this.csvRecords &#x3D; &#x27;Import complete.&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
      })
    }
  }
  importProducts(){
    const items &#x3D;  this.csvRecords  as IProduct[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.getProgressCount(true)
      this.menuService.importProducts(site,items).subscribe(data &#x3D;&gt; {
        this.importProductResults &#x3D; data;
        this.importing &#x3D; false;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  importFlowVendors(){
    const items &#x3D;  this.csvRecords  as FlowVendor[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.getProgressCount(true)
      this.clientTableService.importFlowVendors(site,items).subscribe(data &#x3D;&gt; {
        this.importing &#x3D; false;
        this.importFlowVendorResults &#x3D; data;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  importFlowPrices(){
    const items &#x3D;  this.csvRecords  as FlowPrice[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    if (items) {
      this.getProgressCount(true)
      this.menuService.importFlowPrices(site,items).subscribe(data &#x3D;&gt; {
        this.importFlowPriceResults &#x3D; data;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  importFlowInventory(){
    const items &#x3D;  this.csvRecords  as FlowInventory[];
    if (!items) { this.resultsMessage  &#x3D; &#x27;No files read&#x27;}
    this.resultsMessage &#x3D; &#x27;Processing.&#x27;
    const site  &#x3D; this.siteService.getAssignedSite()
    this.importing &#x3D; true;
    if (items) {
      this.getProgressCount(true)
      this.menuService.importFlowInventory(site,items).subscribe(data &#x3D;&gt; {
        this.importing &#x3D; false;
        this.importFlowInventoryResults &#x3D; data;
        this.csvRecords &#x3D; &#x27;Operation complete&#x27;;
        this.fileImportInput.nativeElement.value &#x3D; &quot;&quot;;
        this.getProgressCount(false)
      })
    }
  }

  resetProgressIndicator(){
    const site  &#x3D; this.siteService.getAssignedSite()
    const item$ &#x3D; this.menuService.resetProgressIndicator(site)
    item$.pipe(
      switchMap(data &#x3D;&gt; {
        {
          return  this.menuService.getImportCountProgress(site)
        }
      }
      )
    ).subscribe(data &#x3D;&gt; {
        this.progress &#x3D; data;
        this.progressValue &#x3D;  +((+data.progress/+data.total ) * 100).toFixed(0)
    })
  }

  randomizeInfo() {
    const site  &#x3D; this.siteService.getAssignedSite()
    const cities$ &#x3D; this.clientTableService.getCitiesList();
    const names$ &#x3D; this.clientTableService.getCitiesList();
    const confirm &#x3D; window.confirm (&#x27;This will randomize your user data, are you sure?&#x27;);
    if (!confirm) { return };

    this.random$ &#x3D; combineLatest(cities$,names$).pipe(
        switchMap( data &#x3D;&gt; {
          let item : NamesCities;
          item.cities &#x3D; data[0];
          item.names &#x3D; data[1];
          return this.clientTableService.randomizeClientInfo(site, item);
        }
    ))


  }
}


</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'NamesCities-1.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
